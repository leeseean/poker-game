var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r["throw"](e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BaseScene=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){t.width=t.stage.stageWidth,t.height=t.stage.stageHeight},t),t}return __extends(t,e),t}(eui.Component);__reflect(BaseScene.prototype,"BaseScene",["eui.UIComponent","egret.DisplayObject"]);var LocalStorage;!function(e){var t=function(){function e(){}return e.prototype.Set=function(e,t){egret.localStorage.setItem(e,t)},e.prototype.Set1=function(e,t){var n=JSON.stringify(t);egret.localStorage.setItem(e,n)},e.prototype.Get=function(e){return egret.localStorage.getItem(e)},e.prototype.Get1=function(e){var t=egret.localStorage.getItem(e),n=JSON.parse(t);return n},e}();e.Storage=t,__reflect(t.prototype,"LocalStorage.Storage")}(LocalStorage||(LocalStorage={}));var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return LoginModule.GetInstance().Init(),PlayerDataModule.GetInstance().Init(),[4,this.loadResource()];case 1:return n.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=n.sent(),platform.login(),t=platform.getUserInfo(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,7,,8]),e=new LoadingUI,e.x=this.stage.width/2-e.width,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),[4,RES.loadGroup("Pai",0,e)];case 4:return n.sent(),[4,RES.loadGroup("UI",0,e)];case 5:return n.sent(),[4,RES.loadGroup("sound",0,e)];case 6:return n.sent(),this.stage.removeChild(e),[3,8];case 7:return t=n.sent(),console.error(t),[3,8];case 8:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=new DdzLoadScene;this.addChild(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,ClientModule.GetInstance().UserInfo]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){return e="?Channel=REG&GameType=RM_DDZ&User=admin&AppName=WX_5E8A",t=new egret.HttpRequest,t.responseType=egret.HttpResponseType.TEXT,t.open("http://139.199.80.217/www/login/login_test.php"+e,egret.HttpMethod.GET),t.send(),t.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this),t.addEventListener(egret.ProgressEvent.PROGRESS,this.onPostProgress,this),[2]})})},e.prototype.onPostComplete=function(e){var t=e.currentTarget;console.log("post data : ",t.response);var n=JSON.parse(t.response);n.IP=n.FES.split(":")[0],n.Port=Number(n.FES.split(":")[1]),ClientModule.GetInstance().UserInfo=n,NetMgr.GetInstance().StartSocket(n.IP,n.Port)},e.prototype.onPostIOError=function(e){console.log("post error : "+e)},e.prototype.onPostProgress=function(e){console.log("post progress : "+Math.floor(100*e.bytesLoaded/e.bytesTotal)+"%")},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function o(e){t.call(r,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(r))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(r,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var AudioMgr=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.GetInstance=function(){return null==this.audio&&(this.audio=new t),this.audio},t.prototype.PlayBgAudio=function(e){null==this.bgSound&&(this.bgSound=RES.getRes(e)),null!=this.bgSoundCanel&&this.bgSoundCanel.stop(),this.bgSoundCanel=this.bgSound.play(0,0)},t.prototype.StopBgAudio=function(){null!=this.bgSoundCanel&&this.bgSoundCanel.stop()},t.prototype.ExtraSound=function(e){var t=RES.getRes(e);t.play(0,1)},t}(egret.DisplayObject);__reflect(AudioMgr.prototype,"AudioMgr");var BaseData=function(){function e(){}return e}();__reflect(BaseData.prototype,"BaseData");var BaseEvent=function(e){function t(t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);var o=e.call(this,t,n,r)||this;return o.controller="",o.action="",o}return __extends(t,e),t}(egret.Event);__reflect(BaseEvent.prototype,"BaseEvent");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?r(o):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var EQiPaiConfig=function(){function e(){}return e}();__reflect(EQiPaiConfig.prototype,"EQiPaiConfig");var EventList=function(){function e(){this.dic=new Array}return e.prototype.Add=function(e,t){this.dic[e]=t},e.prototype.Get=function(e){var t=this.dic[e];return t},e}();__reflect(EventList.prototype,"EventList");var NetEvent=function(e){function t(t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),e.call(this,t,n,r)||this}return __extends(t,e),t}(egret.Event);__reflect(NetEvent.prototype,"NetEvent");var Protocol=function(){function e(){}return e}();__reflect(Protocol.prototype,"Protocol");var SceneMgr=function(){function e(){}return e.AddScene=function(e){null==e||this.sceneList.concat(e)||this.sceneList.push(e)},e.sceneList=new Array,e}();__reflect(SceneMgr.prototype,"SceneMgr");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="加载资源..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var TestDemo=function(){function e(){}return e}();__reflect(TestDemo.prototype,"TestDemo");var Dialog=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/GameSkin/Common/DialogOk.exml",t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){t.width=t.stage.stageWidth,t.height=t.stage.stageHeight},t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.img_dialog_outer.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.Close()},this),this.btn_dialog_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.Close()},this)},t.prototype.Show=function(e){e.contains(this)||e.addChild(this)},t.prototype.Close=function(){null!=this.parent&&this.parent.removeChild(this)},t}(eui.Component);__reflect(Dialog.prototype,"Dialog",["eui.UIComponent","egret.DisplayObject"]);var EButton=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){t.w=t.width,t.h=t.height,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.width-=5,t.height-=5},t),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.width=t.w,t.height=t.h},t),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.width=t.w,t.height=t.h},t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.width=t.w,t.height=t.h},t)},t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Button);__reflect(EButton.prototype,"EButton",["eui.UIComponent","egret.DisplayObject"]);var NetMgr=function(e){function t(){var t=e.call(this)||this;return t.socket=new egret.WebSocket,t.recv_buffer=new egret.ByteArray,t.send_buffer=new egret.ByteArray,t.temp_msg=new SocketMsg,t}return __extends(t,e),t.GetInstance=function(){return null==this.net&&(this.net=new t),this.net},t.prototype.StartSocket=function(e,t){this.socket.connected||(this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.IOError,this),this.socket.addEventListener(egret.Event.CLOSE,this.Close,this),this.socket.connect(e,t),this.conn_serverip=e,this.conn_serverport=t)},t.prototype.SendMsg=function(e){try{this.socket.connected?(this.send_buffer.clear(),this.send_buffer.endian=egret.Endian.BIG_ENDIAN,this.send_buffer.writeInt(e.buff_msg.length),this.send_buffer.endian=egret.Endian.LITTLE_ENDIAN,this.send_buffer.writeBytes(e.buff_msg),this.socket.writeBytes(this.send_buffer,0,this.send_buffer.length),this.socket.flush()):console.error("网络没有连接")}catch(t){console.error(t)}},t.prototype.SendPB=function(e,t,n){this.temp_msg.reset(e),this.temp_msg.wprotobuf(t,n),this.SendMsg(this.temp_msg)},t.prototype.GetStatus=function(){return this.socket.connected},t.prototype.onReceiveMessage=function(){if(this.socket.readBytes(this.recv_buffer,this.recv_buffer.position),this.recv_buffer.bytesAvailable>4){this.recv_buffer.endian=egret.Endian.BIG_ENDIAN;var e=this.recv_buffer.readInt();if(this.recv_buffer.endian=egret.Endian.LITTLE_ENDIAN,this.recv_buffer.bytesAvailable>=e){var t=new SocketMsg;t.fill(this.recv_buffer,this.recv_buffer.position,e),this.processReceive(t)}else console.log("msg len error");this.recv_buffer.clear()}},t.prototype.processReceive=function(e){console.log("recv msg : "+e.name);var t=new NetEvent(e.name);t.msg=e,this.dispatchEvent(t)},t.prototype.Close=function(){console.log("连接关闭")},t.prototype.onSocketOpen=function(){console.log("网络连接成功，发送LOGIN。");var e=ClientModule.GetInstance().UserInfo,n=PB_MSG.MsgLogin.create();n.Version=ClientModule.GetInstance().Version,n.Channel=ClientModule.GetInstance().Channel,n.AppName=ClientModule.GetInstance().AppName,n.User=e.User,n.NonceStr=e.NonceStr,n.Token=e.Token,n.Timestamp=e.Timestamp,n.UID=e.UID,n.RoomType=ClientModule.GetInstance().RoomType,t.GetInstance().SendPB("LOGIN",PB_MSG.MsgLogin,n)},t.prototype.IOError=function(){console.log("网络连接断开")},t.prototype.Emit=function(e,t,n){if(!this.socket.connected){var r=new Protocol;r.controller=e,r.action=t,r.data=n;var o=JSON.stringify(r);this.socket.writeUTF(o)}},t}(egret.DisplayObject);__reflect(NetMgr.prototype,"NetMgr");var SocketMsg=function(){function e(e){void 0===e&&(e=""),this.buff_msg=new egret.ByteArray,this.buff_msg.endian=egret.Endian.LITTLE_ENDIAN,this.reset(e)}return e.prototype.reset=function(e){this.name=e,this.buff_msg.clear(),this.buff_msg.writeInt(0),this.buff_msg.writeByte(0),this.wstring(this.name)},e.prototype.fill=function(e,t,n){this.buff_msg.clear(),this.buff_msg.writeBytes(e,t,n),this.buff_msg.position=5,this.name=this.rstring()},e.prototype.wstring=function(e){this.wint32(e.length),this.buff_msg.writeUTFBytes(e)},e.prototype.wint32=function(e){this.buff_msg.writeInt(e)},e.prototype.wuint32=function(e){this.buff_msg.writeUnsignedInt(e)},e.prototype.wint64=function(e){var t=protobuf.util.LongBits.from(e);this.wuint32(t.lo),this.wuint32(t.hi)},e.prototype.wdouble=function(e){this.buff_msg.writeDouble(e)},e.prototype.wprotobuf=function(e,t){var n=e.encode(t).finish(),r=new egret.ByteArray(n);this.wint32(r.length),this.buff_msg.writeBytes(r,0,r.length)},e.prototype.wjson=function(e){this.wstring(JSON.stringify(e))},e.prototype.rint32=function(){return this.buff_msg.readInt()},e.prototype.ruint32=function(){return this.buff_msg.readUnsignedInt()},e.prototype.rdouble=function(){return this.buff_msg.readDouble()},e.prototype.rstring=function(){var e=this.rint32();return this.buff_msg.readUTFBytes(e)},e.prototype.rint64=function(e){var t=new protobuf.util.LongBits(0,0);return t.hi=this.ruint32(),t.lo=this.ruint32(),t.toLong(e)},e.prototype.rjson=function(){var e=this.rint32(),t=this.buff_msg.readUTFBytes(e);return JSON.parse(t)},e.prototype.rprotobuf=function(e){var t=this.rint32(),n=new egret.ByteArray;return this.buff_msg.readBytes(n,0,t),e.decode(n.bytes)},e}();__reflect(SocketMsg.prototype,"SocketMsg");var PDKUtils=function(){function e(){}return e}();__reflect(PDKUtils.prototype,"PDKUtils");var PDKCard=function(e){function t(){var t=e.call(this)||this;return t.cardSelect=!1,t.skinName="resource/GameSkin/Ddz/Control/Card.exml",t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.cardSelect=!t.cardSelect,t.cardSelect?(t.card_shade.visible=!0,t.y-=15):(t.card_shade.visible=!1,t.y+=15)},t)},t),t}return __extends(t,e),t.prototype.SetValue=function(e){this.Value=e},t.prototype.GetValue=function(){return this.Value},t.prototype.SetSource=function(e){null!=this.card_texture&&(this.card_texture.source=e)},t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(PDKCard.prototype,"PDKCard",["eui.UIComponent","egret.DisplayObject"]);var ClientModule=function(){function e(){this.Version="1.0",this.Channel="REG",this.AppName="WX_5E8A",this.User="admin",this.RoomType="RM_DDZ",this.UserInfo=new JsonUser}return e.GetInstance=function(){return null==this.__self&&(this.__self=new e),this.__self},e}();__reflect(ClientModule.prototype,"ClientModule");var LoginModule=function(){function e(){}return e.prototype.Init=function(){NetMgr.GetInstance().addEventListener("AuthOk",this.CBAuthOk,this)},e.prototype.CBAuthOk=function(){console.log("AuthOk回调，进入大厅场景")},e.GetInstance=function(){return null==this.__self&&(this.__self=new e),this.__self},e}();__reflect(LoginModule.prototype,"LoginModule");var JsonUser=function(){function e(){}return e}();__reflect(JsonUser.prototype,"JsonUser");var PlayerDataModule=function(){function e(){}return e.prototype.Init=function(){NetMgr.GetInstance().addEventListener("SyncPlayerInfo",this.CBSyncPlayerInfo,this)},e.prototype.CBSyncPlayerInfo=function(e){var t=e.msg.rprotobuf(PB_MSG.MsgPlayerInfo);console.log("SyncPlayerInfo"),console.log(t)},e.GetInstance=function(){return null==this.__self&&(this.__self=new e),this.__self},e}();__reflect(PlayerDataModule.prototype,"PlayerDataModule");var DdzLoadScene=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/GameSkin/Ddz/DdzLoadScene.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){var t=this;e.prototype.childrenCreated.call(this),this.viewstack.selectedIndex=0,this.tab_checkStack.dataProvider=new eui.ArrayCollection(["登录","注册"]),this.tab_checkStack.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(){t.viewstack.selectedIndex=1==t.viewstack.selectedIndex?0:1,t.addChild(new LoadView)},this),this.btnLogin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){platform.login();var e=platform.getUserInfo();console.log(e)},this),AudioMgr.GetInstance().PlayBgAudio("bg_mp3")},t}(BaseScene);__reflect(DdzLoadScene.prototype,"DdzLoadScene");var DdzScene=function(e){function t(){var t=e.call(this)||this;return t.cards=[],t.index=0,t.skinName="resource/GameSkin/Ddz/GameScene.exml",t.addEventListener(egret.Event.ADDED_TO_STAGE,function(){console.log(t.chupai_Area.name),t.fapaiTimer=new egret.Timer(200,17),t.fapaiTimer.addEventListener(egret.TimerEvent.TIMER,t.fapai,t),t.fapaiTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,t.fapaiover,t);for(var e=0,n=0;17>n;n++){e+=40;var r=new PDKCard;r.x=e,t.cards.push(r)}t.ready.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.ready.visible=!1,t.invite.visible=!1,t.fapaiTimer.start();var e=new TestDemo;e.Data="数据内容",NetMgr.GetInstance().Emit("user","Register",e)},t),t.invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new Dialog;e.Show(t)},t)},t),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.fapai=function(){this.chupai_Area.addChild(this.cards[this.index]),this.index+=1},t.prototype.fapaiover=function(){console.log("发牌完成")},t}(BaseScene);__reflect(DdzScene.prototype,"DdzScene");var LoadView=function(e){function t(){var t=e.call(this)||this;return t.skinName="resource/GameSkin/Common/LoadScene.exml",t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this);var t=egret.Tween.get(this.img_load,{loop:!0});t.to({rotation:360},2e3)},t}(BaseScene);__reflect(LoadView.prototype,"LoadView");